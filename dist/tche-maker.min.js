/*! tche-maker 07-01-2016 */
"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _typeof(a){return a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function Trigger(a){return a._listeners={},a.on=a.addListener=function(a,b){"undefined"==typeof this._listeners[a]&&(this._listeners[a]=[]),this._listeners[a].push(b)},a.fire=function(a){if(a=a||{},"string"==typeof a&&(a={type:a}),a.target||(a.target=this),!a.type)throw new Error("Event object missing 'type' property.");if(this._listeners[a.type]instanceof Array){var b=this._listeners[a.type],c=Array.prototype.slice.call(arguments);c.shift();for(var d=0,e=b.length;e>d;d++)b[d].apply(this,c)}},a.removeListener=function(a,b){if(this._listeners[a]instanceof Array)for(var c=this._listeners[a],d=0,e=c.length;e>d;d++)if(c[d]===b){c.splice(d,1);break}},a}var _get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Array.prototype.find||(Array.prototype.find=function(a){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(b=c[f],a.call(e,b,f,c))return b});var BAH=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"log",value:function(a){console.log(a)}},{key:"error",value:function(a){console.error(a)}}]),a}(),TCHE={globals:{},data:{},maps:{}};!function(a){function b(a,b,c,d,e){e=e||"application/json";var f=new XMLHttpRequest;f.open("GET",b),e&&f.overrideMimeType&&f.overrideMimeType(e),void 0===c&&(c=function(a,b,c){a.status<400&&(TCHE.data[c]=JSON.parse(a.responseText))}),f.onload=function(){c.call(this,f,b,a)},f.onerror=d,void 0!==c&&(TCHE.data[a]=null),f.send()}function c(b){var c;if(b instanceof Array)return b.map(function(b){return a.deepClone(b)});if(b&&!b.prototype&&("object"==("undefined"==typeof b?"undefined":_typeof(b))||b instanceof Object)){c={};for(var d in b)c[d]=a.deepClone(b[d]);return c}return b}function d(a){var b;if(a instanceof Array)return a.slice(0);if(a&&!a.prototype&&("object"==("undefined"==typeof a?"undefined":_typeof(a))||a instanceof Object)){b={};for(var c in a)b[c]=a[c];return b}return a}function e(a,b){TCHE[a]=b,TCHE.trigger(b.prototype)}function f(a,b){TCHE[a]=b,TCHE.trigger(b)}function g(a){a.screenWidth=a.screenWidth||800,a.screenHeight=a.screenHeight||600,a.backgroundColor=a.backgroundColor||1087931,a.showFps=a.showFps!==!1,a.fpsVisibleOnStartup=a.fpsVisibleOnStartup===!0,a.playerX=a.playerX||0,a.playerY=a.playerY||0,a.initialMap=a.initialMap||null,TCHE.settings=a}function h(){TCHE.globals.player=new TCHE.Player,TCHE.globals.map=new TCHE.Map}function i(){TCHE.settings.showFps&&(TCHE.meter=new FPSMeter({theme:"transparent",graph:1,decimals:0}),TCHE.settings.fpsVisibleOnStartup||TCHE.meter.hide(),TCHE.InputManager.on("FPS",function(a){return TCHE.meter.isPaused?TCHE.meter.show():TCHE.meter.hide()}))}function j(a){TCHE.fillSettings(a),TCHE.renderer=PIXI.autoDetectRenderer(a.screenWidth,a.screenHeight,{backgroundColor:a.backgroundColor}),document.body.appendChild(TCHE.renderer.view),i(),h(),TCHE.SceneManager.start(TCHE.SceneLaunch),TCHE.fire("started")}function k(){TCHE.meter&&TCHE.meter.tickStart()}function l(){TCHE.meter&&TCHE.meter.tick()}a.trigger=Trigger,a.fillSettings=g,a.ajaxLoadFileAsync=b,a.shallowClone=d,a.deepClone=c,a.init=j,a.startFrame=k,a.endFrame=l,a.registerClass=e,a.registerStaticClass=f,a.trigger(TCHE)}(TCHE),function(){var a=function(){function a(){_classCallCheck(this,a),this._x=null,this._y=null,this._xDest=null,this._yDest=null,this._direction=null,this._image=null,this._dirty=!1,this._height=null,this._width=null,this._lastBlockedByCharacter=null,this._lastBlockCharacter=null,this._frameInitialX=null,this._frameInitialY=null}return _createClass(a,[{key:"update",value:function(){this._frameInitialX=this.x,this._frameInitialY=this.y;var a={x:["right","left"],y:["down","up"]};this.move(Object.keys(a).reduce(function(b,c){var d=this["_"+c+"Dest"];if(d){var e=this["_"+c];Math.abs(d-e)>=this.stepSize?b.push(d>e?a[c][0]:a[c][1]):this["_"+c+"Dest"]=void 0}return b}.bind(this),[]).join(" "))}},{key:"setDest",value:function(a,b){this._xDest=a,this._yDest=b}},{key:"canMove",value:function(a){return TCHE.globals.map.canMove(this,a)}},{key:"move",value:function(a){a.indexOf("left")>=0&&this.canMove("left")?this._x-=this.stepSize:a.indexOf("right")>=0&&this.canMove("right")&&(this._x+=this.stepSize),a.indexOf("up")>=0&&this.canMove("up")?this._y-=this.stepSize:a.indexOf("down")>=0&&this.canMove("down")&&(this._y+=this.stepSize),this.isMoving()&&(this._lastBlockCharacter=null,this._lastBlockedByCharacter=null,TCHE.globals.map.requestCollisionMapRefresh())}},{key:"isMoving",value:function(){return this._frameInitialX!==this._x||this._frameInitialY!==this._y}},{key:"onBlockCharacter",value:function(a){this._lastBlockCharacter!==a&&(this._lastBlockCharacter=a,this.fire("blockCharacter",a))}},{key:"onBlockedBy",value:function(a){this._lastBlockedByCharacter!==a&&(this._lastBlockedByCharacter=a,this.fire("blockedBy",a))}},{key:"x",get:function(){return this._x},set:function(a){this._x=a}},{key:"y",get:function(){return this._y},set:function(a){this._y=a}},{key:"xDest",get:function(){return this._xDest},set:function(a){this._xDest=a}},{key:"yDest",get:function(){return this._yDest},set:function(a){this._yDest=a}},{key:"direction",get:function(){return this._direction},set:function(a){this._direction=a}},{key:"dirty",get:function(){return this._dirty},set:function(a){this._dirty=a}},{key:"width",get:function(){return this._width},set:function(a){this._width=a}},{key:"height",get:function(){return this._height},set:function(a){this._height=a}},{key:"rightX",get:function(){return this.x+this.width}},{key:"bottomY",get:function(){return this.y+this.height}},{key:"image",get:function(){return this._image},set:function(a){this._image=a,this._dirty=!0}},{key:"stepSize",get:function(){return 5}}]),a}();TCHE.registerClass("Character",a)}(),function(){var a=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a._sprite=null,a}return _inherits(b,a),_createClass(b,[{key:"update",value:function(){}},{key:"sprite",get:function(){return this._sprite},set:function(a){this._sprite=a}}]),b}(PIXI.Container);TCHE.registerClass("Sprite",a)}(),function(){var a=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return c._character=a,c.createPixiSprite(),c}return _inherits(b,a),_createClass(b,[{key:"createPixiSprite",value:function(){this._character.dirty&&(this._texture=null,this._sprite&&(this._sprite.texture=null)),!this._texture&&this._character.image&&(this._texture=PIXI.Texture.fromImage(this._character.image)),!this._sprite&&this._texture&&(this._sprite=new PIXI.Sprite(this._texture),this.addChild(this._sprite)),this._sprite&&this._texture&&this._sprite._texture!=this._texture&&(this._sprite.texture=this._texture),this._character.dirty=!1}},{key:"update",value:function(){this.createPixiSprite(),this._sprite&&(this.position.x=this._character.x,this.position.y=this._character.y)}},{key:"character",get:function(){return this._character},set:function(a){this._character=a}}]),b}(TCHE.Sprite);TCHE.registerClass("CharacterSprite",a)}(),function(){var a=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return c._map=a,c}return _inherits(b,a),_createClass(b,[{key:"map",get:function(){return this._map},set:function(a){this._map=a}}]),b}(TCHE.Sprite);TCHE.registerClass("MapSprite",a)}(),function(){var a=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this,a));return c._objectSprites=[],c.createBackground(),c.createObjects(),c.createPlayer(),c}return _inherits(b,a),_createClass(b,[{key:"createBackground",value:function(){this._backgroundGraphic=new PIXI.Graphics,this._backgroundGraphic.beginFill(this._map._mapData["background-color"]),this._backgroundGraphic.drawRect(0,0,TCHE.renderer.width,TCHE.renderer.height),this._backgroundGraphic.endFill(),this._backgroundTexture=new PIXI.RenderTexture(TCHE.renderer,TCHE.renderer.width,TCHE.renderer.height),this._backgroundTexture.render(this._backgroundGraphic),this._backgroundSprite=new PIXI.Sprite(this._backgroundTexture),this.addChild(this._backgroundSprite)}},{key:"createPlayer",value:function(){this._playerSprite=new TCHE.CharacterSprite(TCHE.globals.player),this.addChild(this._playerSprite)}},{key:"createObjects",value:function(){this._objectSprites=[],this._map.objects.forEach(function(a){var b=new TCHE.CharacterSprite(a);this._objectSprites.push(b),this.addChild(b)}.bind(this))}},{key:"updatePlayer",value:function(){this._playerSprite.update()}},{key:"updateObjects",value:function(){this._objectSprites.forEach(function(a){a.update()})}},{key:"update",value:function(){_get(Object.getPrototypeOf(b.prototype),"update",this).call(this),this.updateObjects(),this.updatePlayer()}}]),b}(TCHE.MapSprite);TCHE.registerClass("Map2d",a)}(),function(){var a=!1,b=0,c=function(){function c(){_classCallCheck(this,c)}return _createClass(c,null,[{key:"_loadGameSettings",value:function(){var a="./game.json";TCHE.ajaxLoadFileAsync("game",a)}},{key:"_loadAllMaps",value:function(){if(TCHE.data.game){var a=TCHE.data.game.maps;a.forEach(function(a){this._loadMapData(a)}.bind(this))}}},{key:"_loadMapData",value:function(a){var c="./maps/"+a+".json";b++,TCHE.maps[a]=null,TCHE.ajaxLoadFileAsync(a,c,function(a,c,d){if(!(a.status<400))throw console.log(arguments),new Error("Failed to load map.");TCHE.maps[d]=JSON.parse(a.responseText),b--},function(){throw console.log(arguments),new Error("Failed to load map.")})}},{key:"update",value:function(){return TCHE.data.game?void(a||(a=!0,this._loadAllMaps())):void(void 0===TCHE.data.game&&this._loadGameSettings())}},{key:"isLoaded",value:function(){return TCHE.data.game&&a?b>0?!1:!0:!1}}]),c}();TCHE.registerStaticClass("FileManager",c)}(),function(){function a(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}var b={},c={},d={},e=[],f=[],g={9:"tab",13:"ok",16:"shift",17:"control",18:"control",27:"escape",32:"ok",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",45:"escape",65:"left",83:"down",68:"right",87:"up",74:"ok",75:"shift",85:"tool",81:"pageup",69:"pagedown",96:"escape",98:"down",100:"left",102:"right",104:"up",113:"F2"},h=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"update",value:function(){e=[],f=[];for(var a in c)c[a]!==d[a]&&(c[a]?e.push(a):f.push(a));d=TCHE.shallowClone(c);for(var b=0;b<e.length;b++)for(var g=this.getKeyNames(e[b]),h=0;h<g.length;h++)this.fire(g[h],{})}},{key:"addKeyCode",value:function(a,b){g[a]=b}},{key:"addKeyAlias",value:function(a,c){b[a]=b[a]||[],b[a].push(c)}},{key:"isKeyCodePressed",value:function(a){return!!c[a]}},{key:"isKeyCodeTriggered",value:function(a){return e.indexOf(a)>=0}},{key:"isKeyCodeReleased",value:function(a){return f.indexOf(a)>=0}},{key:"getKeyCodes",value:function(a){var c=[];for(var d in g)if(g.hasOwnProperty(d)){if(g[d].toUpperCase()==a.toUpperCase()){c.push(d);continue}var e=g[d];b[e]&&b[e].indexOf(a)>=0&&c.push(d)}return c}},{key:"getKeyNames",value:function(a){var c=[];if(g[a]){var d=g[a];c.push(d),b[d]&&(c=c.concat(b[d]))}return c}},{key:"isKeyNamePressed",value:function(a){var b=this.getKeyCodes(a);return b.find(function(a){return this.isKeyCodePressed(a)}.bind(this))||!1}},{key:"isKeyNameReleased",value:function(a){var b=this.getKeyCodes(a);return b.find(function(a){return this.isKeyCodeReleased(a)}.bind(this))||!1}},{key:"isKeyNameTriggered",value:function(a){var b=this.getKeyCodes(a);return b.find(function(a){return this.isKeyCodeTriggered(a)}.bind(this))||!1}},{key:"isKeyPressed",value:function(a){return"string"==typeof a?this.isKeyNamePressed(a):this.isKeyCodePressed(a)}},{key:"isKeyTriggered",value:function(a){return"string"==typeof a?this.isKeyNameTriggered(a):this.isKeyCodeTriggered(a)}},{key:"isKeyReleased",value:function(a){return"string"==typeof a?this.isKeyNameReleased(a):this.isKeyCodeReleased(a)}},{key:"getPressedKeys",value:function(a){return Object.keys(a).filter(function(a){return this.isKeyCodePressed(a)}.bind(this))}},{key:"getFirstDirection",value:function(){return["left","right","up","down"].find(function(a){return this.isKeyNamePressed(a)}.bind(this))||""}},{key:"getDirection",value:function(){return["left","right","up","down"].filter(function(a){return this.isKeyNamePressed(a)}.bind(this)).join("-")}},{key:"onKeyDown",value:function(a){this.isBlockedKey(a.keyCode)&&a.preventDefault(),c[a.keyCode]=!0}},{key:"onKeyUp",value:function(a){c[a.keyCode]=!1}},{key:"onWindowBlur",value:function(){this.clear()}},{key:"clear",value:function(){c={}}},{key:"isBlockedKey",value:function(a){switch(a){case 8:case 33:case 34:case 37:case 38:case 39:case 40:return!0;default:return!1}}}]),a}();document.addEventListener("keydown",h.onKeyDown.bind(h)),document.addEventListener("keyup",h.onKeyUp.bind(h)),window.addEventListener("blur",h.onWindowBlur.bind(h)),TCHE.on("started",function(){TCHE.renderer.view.addEventListener("click",function(b){var c=a(this,b);TCHE.globals.player.setDest(c.x,c.y)})}),TCHE.registerStaticClass("InputManager",h)}(),function(){var a=void 0,b=void 0,c=function(){function c(){_classCallCheck(this,c)}return _createClass(c,[{key:"scene",get:function(){return a},set:function(b){a=b}},{key:"newScene",get:function(){return b}}],[{key:"requestAnimationFrame",value:function(){window.requestAnimationFrame(this.update.bind(this))}},{key:"_doSceneChange",value:function(){void 0!==b&&(a&&(a.terminate(),a=void 0),b&&(a=new b)),b=void 0}},{key:"update",value:function(){TCHE.startFrame(),this._doSceneChange(),TCHE.FileManager.update(),TCHE.InputManager.update(),TCHE.globals.map.update(),TCHE.globals.player.update(),a&&(a.update(),TCHE.renderer.render(a)),TCHE.endFrame(),a&&this.requestAnimationFrame()}},{key:"changeScene",value:function(a){b=a}},{key:"start",value:function(a){this.changeScene(a),this.requestAnimationFrame()}},{key:"end",value:function(){this.changeScene(null)}}]),c}();TCHE.registerStaticClass("SceneManager",c)}(),function(){return TCHE.SoundManager=Trigger(new(function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"play",value:function(a){createjs.Sound.play(a)}},{key:"setSound",value:function(a,b){createjs.Sound.registerSound({src:b,id:a})}},{key:"setSounds",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?"./assets/":arguments[1];createjs.Sound.createjs.Sound.registerSounds(sounds,b)}}]),a}()))}(),function(){var a=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this))}return _inherits(b,a),_createClass(b,[{key:"update",value:function(){}},{key:"terminate",value:function(){}}]),b}(PIXI.Container);TCHE.registerClass("Scene",a)}(),function(){var a=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return a.createBackground(),a.createMessage(),a}return _inherits(b,a),_createClass(b,[{key:"update",value:function(){this.updateBackground(),this.updateMessage()}},{key:"createBackground",value:function(){this._backgroundGraphic=new PIXI.Graphics,this._backgroundGraphic.beginFill("0xCCCCCC"),this._backgroundGraphic.drawRect(0,0,TCHE.renderer.width,TCHE.renderer.height),this._backgroundGraphic.endFill(),this._backgroundTexture=new PIXI.RenderTexture(TCHE.renderer,TCHE.renderer.width,TCHE.renderer.height),this._backgroundTexture.render(this._backgroundGraphic),this._backgroundSprite=new PIXI.Sprite(this._backgroundTexture),this.addChild(this._backgroundSprite)}},{key:"createMessage",value:function(){this._messageText="Now Loading",this._messageSprite=new PIXI.Text(this._messageText),this._messageSprite.anchor.x=0,this._messageSprite.anchor.y=.5,this._messageSprite.position.y=Math.floor(TCHE.renderer.height/2),this._messageSprite.position.x=Math.floor(TCHE.renderer.width/2-this._messageSprite.width/2),this.addChild(this._messageSprite),this._dots=0,this._counter=0}},{key:"updateBackground",value:function(){}},{key:"updateMessage",value:function(){if(this._counter++,this._counter>20){this._counter=0,this._dots++,this._dots>3&&(this._dots=0);for(var a=this._messageText,b=0;b<this._dots;b++)a+=".";this._messageSprite.text=a}}}]),b}(TCHE.Scene);TCHE.registerClass("SceneLoading",a)}(),function(){var a=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this))}return _inherits(b,a),_createClass(b,[{key:"update",value:function(){TCHE.FileManager.isLoaded()&&(TCHE.fire("ready"),TCHE.SceneManager.changeScene(TCHE.SceneMap))}}]),b}(TCHE.SceneLoading);TCHE.registerClass("SceneLaunch",a)}(),function(){var a=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this));return TCHE.globals.player.x=TCHE.data.game.player.x,TCHE.globals.player.y=TCHE.data.game.player.y,TCHE.globals.player.width=TCHE.data.game.player.width,TCHE.globals.player.height=TCHE.data.game.player.height,TCHE.globals.player.image=TCHE.data.game.player.image,TCHE.globals.map.loadMap(TCHE.data.game.initialMap),a._mapSprite=new TCHE.Map2d(TCHE.globals.map),a.addChild(a._mapSprite),a}return _inherits(b,a),_createClass(b,[{key:"update",value:function(){_get(Object.getPrototypeOf(b.prototype),"update",this).call(this),this._mapSprite.update()}}]),b}(TCHE.Scene);TCHE.registerClass("SceneMap",a)}(),function(){var a=!0,b=function(){function b(){_classCallCheck(this,b),this._mapData={},this._objects=[],this._collisionMap=[]}return _createClass(b,[{key:"requestCollisionMapRefresh",value:function(){a=!0}},{key:"createObjects",value:function(){var b=[];this._mapData&&(b=this._mapData.objects||b),b.forEach(function(a){var b=new TCHE.Character;b.x=a.x,b.y=a.y,b.width=a.width,b.height=a.height,b.image=a.image,this._objects.push(b)}.bind(this)),a=!0}},{key:"addCharacterToCollisionMap",value:function(a){for(var b=a.x;b<a.rightX;b++)for(var c=a.y;c<a.bottomY;c++)(this._collisionMap.length<b||!this._collisionMap[b])&&(this._collisionMap[b]=[]),(this._collisionMap[b].length<c||!this._collisionMap[b][c])&&(this._collisionMap[b][c]=[]),this._collisionMap[b][c].push(a)}},{key:"createCollisionMap",value:function(){this._collisionMap=[];for(var b=0;b<this._objects.length;b++){var c=this._objects[b];this.addCharacterToCollisionMap(c)}this.addCharacterToCollisionMap(TCHE.globals.player),a=!1}},{key:"update",value:function(){}},{key:"isValid",value:function(a,b){return a>=this.width?!1:b>=this.height?!1:0>a?!1:0>b?!1:!0}},{key:"isCollided",value:function(a,b,c){if(a>this.collisionMap.length)return!1;if(!this.collisionMap[a])return!1;if(b>this.collisionMap[a].length)return!1;if(!this.collisionMap[a][b])return!1;var d=this.collisionMap[a][b].find(function(a){return a!=c});return void 0===d?!1:(d.onBlockCharacter(c),c.onBlockedBy(d),!0)}},{key:"canMoveLeft",value:function(a){for(var b=a.y;b<a.bottomY;b++){if(!this.isValid(a.x-a.stepSize,b))return!1;for(var c=a.stepSize;c>0;c--)if(this.isCollided(a.x-c,b,a))return!1}return!0}},{key:"canMoveRight",value:function(a){for(var b=a.y;b<a.bottomY;b++){if(!this.isValid(a.rightX+a.stepSize,b))return!1;for(var c=a.stepSize;c>0;c--)if(this.isCollided(a.rightX+c,b,a))return!1}return!0}},{key:"canMoveUp",value:function(a){for(var b=a.x;b<a.rightX;b++){if(!this.isValid(b,a.y-a.stepSize))return!1;for(var c=a.stepSize;c>0;c--)if(this.isCollided(b,a.y-c,a))return!1}return!0}},{key:"canMoveDown",value:function(a){for(var b=a.x;b<a.rightX;b++){if(!this.isValid(b,a.bottomY+a.stepSize))return!1;for(var c=a.stepSize;c>0;c--)if(this.isCollided(b,a.bottomY+c,a))return!1}return!0}},{key:"canMove",value:function(a,b){if(b.indexOf("left")>=0){if(!this.canMoveLeft(a))return!1}else if(b.indexOf("right")>=0&&!this.canMoveRight(a))return!1;if(b.indexOf("up")>=0){if(!this.canMoveUp(a))return!1}else if(b.indexOf("down")>=0&&!this.canMoveDown(a))return!1;return!0}},{key:"loadMap",value:function(a){this.mapData=TCHE.maps[a]}},{key:"mapData",get:function(){return this._mapData},set:function(a){this._mapData=a,this._objects=[],this.createObjects()}},{key:"width",get:function(){return this._mapData.width||0}},{key:"height",get:function(){return this._mapData.height||0}},{key:"objects",get:function(){return this._objects}},{key:"collisionMap",get:function(){return a&&this.createCollisionMap(),this._collisionMap}}]),b}();TCHE.registerClass("Map",b)}(),function(){var a=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).call(this))}return _inherits(b,a),_createClass(b,[{key:"update",value:function(){_get(Object.getPrototypeOf(b.prototype),"update",this).call(this),this.processInput()}},{key:"processInput",value:function(){var a=TCHE.InputManager.getDirection();a&&this.move(a)}}]),b}(TCHE.Character);TCHE.registerClass("Player",a)}();